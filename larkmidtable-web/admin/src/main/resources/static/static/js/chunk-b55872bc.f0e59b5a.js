(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b55872bc"],{"1b55":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wrapper-visual-api"},[r("div",{staticClass:"form-container"},[e.ruleForm?r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"数据源ID",prop:"datasource_id"}},[e.sourceList?r("el-select",{staticStyle:{width:"310px"},attrs:{placeholder:"请选择"},model:{value:e.ruleForm.datasource_id,callback:function(t){e.$set(e.ruleForm,"datasource_id",t)},expression:"ruleForm.datasource_id"}},e._l(e.sourceList,(function(e){return r("el-option",{key:"datasource_id_"+e.id,attrs:{label:e.datasourceName,value:e.id}})})),1):e._e()],1),r("el-form-item",{attrs:{label:"SQL语句",prop:"sql_text"}},[r("SqlEditor",{model:{value:e.ruleForm.sql_text,callback:function(t){e.$set(e.ruleForm,"sql_text",t)},expression:"ruleForm.sql_text"}})],1),r("el-form-item",{attrs:{label:"JSON参数",prop:"params"}},[r("el-input",{staticStyle:{"white-space":"pre"},attrs:{autosize:{minRows:2,maxRows:12},type:"textarea",placeholder:"请输入"},model:{value:e.ruleForm.params,callback:function(t){e.$set(e.ruleForm,"params",t)},expression:"ruleForm.params"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.testConnect("ruleForm")}}},[e._v("发送请求")]),r("el-button",{attrs:{type:"primary"},on:{click:e.formartSql}},[e._v("格式化SQL")])],1)],1):e._e()],1),r("div",{staticClass:"res-form",domProps:{innerHTML:e._s(e.resStr)}})])},i=[],s=(r("ac1f"),r("5319"),r("b0c0"),r("e9c4"),r("1bf5")),o=r("db05"),n=r("b252"),u={components:{SqlEditor:s["a"]},data:function(){return{ruleForm:{name:"",path:"",group_id:"",describe:"",datasource_id:"",params:"",sql_text:""},paramsArr:[],rules:{name:[{required:!0,message:"不能为空",trigger:"blur"}],path:[{required:!0,message:"不能为空",trigger:"blur"}],group_id:[{required:!0,message:"不能为空",trigger:"blur"}],describe:[{required:!0,message:"不能为空",trigger:"blur"}],datasource_id:[{required:!0,message:"不能为空",trigger:"blur"}],params:[{required:!0,message:"不能为空",trigger:"blur"}],sql_text:[{required:!0,message:"不能为空",trigger:"blur"}]},resStr:"",sourceList:null}},mounted:function(){var e=this;Object(n["c"])().then((function(t){e.sourceList=t.content.data}))},methods:{formartSql:function(){var e=this,t=this.ruleForm;this.ruleForm=null,t.sql_text=Object(o["format"])(t.sql_text).replace(/# /g,"#").replace(/{ /g,"{").replace(/ }/g,"}").replace(/< foreach/g,"\n<foreach\n").replace(/< \/ foreach >/g,"\n</foreach>\n").replace(/< if/g,"\n<if").replace(/< \/ if >/g,"\n</if>\n").replace(/<\nwhere\n {2}>/g,"\n<where>\n").replace(/< \/\nwhere\n {2}>/g,"\n</where>\n").replace(/< trim/g,"\n<trim").replace(/< \/ trim >/g,"\n</trim>\n").toLowerCase(),setTimeout((function(){e.ruleForm=t}),200)},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;Object(n["a"])({name:t.ruleForm.name,path:t.ruleForm.path,group_id:t.ruleForm.group_id,describe:t.ruleForm.describe,datasource_id:t.ruleForm.datasource_id,params:t.ruleForm.params,sql_text:t.ruleForm.sql_text}).then((function(){t.$message.success("新增成功"),t.ruleForm={name:"",path:"",group_id:"",describe:"",datasource_id:"",params:"",sql_text:""}}))}))},testConnect:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;Object(n["b"])({datasource_id:t.ruleForm.datasource_id,params:t.ruleForm.params,sql_text:t.ruleForm.sql_text}).then((function(e){t.resStr=JSON.stringify(e,null,2),t.$message.success("连接成功")}),(function(e){t.resStr=JSON.stringify(e,null,2)}))}))},resetForm:function(e){this.$refs[e].resetFields()}}},l=u,c=(r("427d"),r("2877")),d=Object(c["a"])(l,a,i,!1,null,"66fb2be8",null);t["default"]=d.exports},"1bf5":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"mycode",staticClass:"codesql",domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})},i=[],s=(r("0f7c"),r("a7be"),r("f6b6"),r("56b3"));r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var o={props:{value:{type:String,default:""},sqlStyle:{type:String,default:"default"},readOnly:{type:[Boolean,String]}},data:function(){return{editor:null}},computed:{newVal:function(){return this.editor?this.editor.getValue():""}},watch:{newVal:function(e,t){this.editor&&(this.$emit("input",this.editor.getValue()),this.$emit("changeTextarea",this.editor.getValue()))}},mounted:function(){var e=this,t="text/x-mariadb";console.dir(s),this.editor=s.fromTextArea(this.$refs.mycode,{value:this.value,mode:t,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,cursorHeight:1,lineWrapping:!0,readOnly:this.readOnly,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1}}),this.editor.on("inputRead",(function(){e.editor.showHint()}))},methods:{setVal:function(){this.editor&&(""===this.value?this.editor.setValue(""):this.editor.setValue(this.value))}}},n=o,u=(r("a96bd"),r("2877")),l=Object(u["a"])(n,a,i,!1,null,null,null);t["a"]=l.exports},"427d":function(e,t,r){"use strict";r("9295")},5258:function(e,t,r){},9295:function(e,t,r){},a96bd:function(e,t,r){"use strict";r("5258")},b252:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return n}));var a=r("b775");function i(e){return Object(a["a"])({url:"/api/apiConfig/add",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/api/apiConfig/update",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/api/apiConfig/execute",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/api/apiConfig/listDataSourceName",method:"get",params:e})}}}]);